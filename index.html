<!DOCTYPE html>
<html lang="en" style="visibility:hidden;opacity:0">

<head>
    <meta charset="utf-8">
    <title>GridWorld</title>

    <!-- Preload and load CSS - reveal page once loaded -->
    <link rel="preload" href="css/styles.css" as="style">
    <link rel="stylesheet" href="css/styles.css"
        onload="document.documentElement.style.visibility='';document.documentElement.style.opacity=''">
    <noscript>
        <link rel="stylesheet" href="css/styles.css">
    </noscript>

    <meta name="Description" content="Javascript library to generate a sphere covered in hexagons." />
    <meta name="Keywords"
        content="hexasphere, hexasphere.js, geodesic sphere, geodesic polyhedron, javascript, hexagons" />

    <!-- Webpack will inject CSS <link> and JS <script> tags automatically -->
    <link rel="icon" href="favicon.ico">
    <!-- Globe emoji as favicon for modern browsers -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸŒ</text></svg>">
</head>

<body>
    <div id="stars" class="stars"></div>
    <div id="dashboard">
        <!-- Dashboard content will go here -->
        <div id="rust-population" class="dashboard-stat" title="Rust ECS Population">
            <span class="stat-icon">ğŸ‘¤</span>
            <span id="rust-pop-value">0</span>
        </div>
        <button id="reset-data" class="dashboard-button reset-button">ğŸ”„ Restart</button>
        <button id="show-stats" class="dashboard-button">ğŸ“Š Stats</button>
        <button id="save-game" class="dashboard-button save-button">ğŸ’¾ Save</button>
        <button id="load-game" class="dashboard-button load-button">ğŸ“¥ Load</button>
        <div class="tile-search-container">
            <input type="number" id="tile-search-input" class="tile-search-input" placeholder="Tile ID" min="0">
            <button id="tile-search-btn" class="dashboard-button search-button">ğŸ”</button>
        </div>
        <button id="toggle-help" class="dashboard-toggle-help">?</button>
    </div>
    <div id="container">
    </div>
    <div id="tileInfoPanel" class="tile-info-panel hidden">
        <div class="tile-info-header">
            <strong id="tileInfoTitle">Tile Information</strong>
            <button id="closeInfoPanel" class="close-info-panel">Ã—</button>
        </div>
        <div class="tile-info-content">
            <div class="info-panel-page" id="info-panel-page-1"><!-- Dynamic: Population --></div>
            <div class="info-panel-page hidden" id="info-panel-page-2"><!-- Dynamic: Buildings --></div>
            <div class="info-panel-page hidden" id="info-panel-page-3">
                <h3>ğŸŒ¾ Resources</h3>
                <p>Coming soon...</p>
            </div>
            <div class="info-panel-page hidden" id="info-panel-page-4">
                <h3>âš”ï¸ Military</h3>
                <p>Coming soon...</p>
            </div>
            <div class="info-panel-page hidden" id="info-panel-page-5">
                <h3>ğŸ’° Economy</h3>
                <p>Coming soon...</p>
            </div>
            <div class="info-panel-page hidden" id="info-panel-page-6">
                <h3>âš™ï¸ Settings</h3>
                <label><input type="checkbox" id="auto-manage-population"> Auto-manage population</label>
                <label><input type="checkbox" id="enable-trade"> Enable trade</label>
                <button id="reset-tile-btn">Reset Tile</button>
            </div>
        </div>
        <div class="info-panel-buttons">
            <button class="info-panel-btn active" id="info-btn-1">ğŸ‘¤</button>
            <button class="info-panel-btn" id="info-btn-2">ğŸ›ï¸</button>
            <button class="info-panel-btn" id="info-btn-3">ğŸŒ¾</button>
            <button class="info-panel-btn" id="info-btn-4">âš”ï¸</button>
            <button class="info-panel-btn" id="info-btn-5">ğŸ’°</button>
            <button class="info-panel-btn" id="info-btn-6">âš™ï¸</button>
        </div>
    </div>
    <!-- Chart.js for statistics charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Info panel tab/page switching logic
        (function () {
            const PAGES = 6;
            const CLOSE_DEBOUNCE = 300;

            function switchPage(pageNum) {
                // Debounce close action
                if (window.__tileSelectorJustClosed && Date.now() - window.__tileSelectorJustClosed < CLOSE_DEBOUNCE) return;

                const panel = document.getElementById('tileInfoPanel');
                if (!panel) return;

                // Show panel
                panel.classList.remove('hidden');
                panel.style.cssText = 'opacity:1;transform:translateY(0);pointer-events:auto;display:flex;';

                // Switch pages using CSS classes
                for (let i = 1; i <= PAGES; i++) {
                    const page = document.getElementById('info-panel-page-' + i);
                    const btn = document.getElementById('info-btn-' + i);
                    if (page) page.classList.toggle('hidden', i !== pageNum);
                    if (btn) btn.classList.toggle('active', i === pageNum);
                }
            }

            document.addEventListener('DOMContentLoaded', function () {
                for (let i = 1; i <= PAGES; i++) {
                    const btn = document.getElementById('info-btn-' + i);
                    if (btn) btn.addEventListener('click', function (e) {
                        e.preventDefault();
                        e.stopPropagation();
                        switchPage(i);
                    });
                }
            });
        })();
    </script>
    <script>
        // Rust ECS population display
        (function () {
            const popEl = document.getElementById('rust-pop-value');
            if (!popEl) return;

            async function updateRustPopulation() {
                try {
                    const res = await fetch('/api/rust/population');
                    const data = await res.json();
                    if (data.success) {
                        popEl.textContent = data.population.toLocaleString();
                    }
                } catch (e) {
                    // Silent fail - server may not be up yet
                }
            }

            // Initial fetch and periodic update
            updateRustPopulation();
            setInterval(updateRustPopulation, 2000);
        })();
    </script>
    <!-- ref:include analytics -->
    <!-- endref -->

</body>

</html>